apply plugin: 'kotlin'
apply plugin: 'application'
apply plugin: 'com.github.johnrengelman.shadow'

version = 0.01
mainClassName = 'com.retrobot.core.Launcher'


buildscript {
    ext.kotlin_version = '1.4.0'

    ext.coroutines_version = '1.3.9'
    ext.emoji_java_version = '5.1.1'
    ext.exposed_version = '0.25.1'
    ext.h2_version = '1.4.200'
    ext.jda_version = '4.2.0_192'
    ext.junit5_version = '5.6.2'
    ext.koin_version = '2.1.6'
    ext.konfig_version = '1.6.10.0'
    ext.kotlin_csv_version = '0.11.0'
    ext.mockk_version = '1.10.0'
    ext.scrimage_version = '4.0.6'
    ext.shadow_version = '6.0.0'
    ext.twitch4j_version = '1.1.0'


    repositories {
        jcenter()
        mavenCentral()
    }

    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
        classpath "com.github.jengelman.gradle.plugins:shadow:$shadow_version"
    }
}

allprojects {
    repositories {
        jcenter()
    }
}

dependencies {
    implementation "org.jetbrains.exposed:exposed-core:$exposed_version"
    implementation "org.jetbrains.exposed:exposed-jdbc:$exposed_version"
    implementation "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"
    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-core:$coroutines_version"
    implementation "net.dv8tion:JDA:$jda_version"
    implementation "com.sksamuel.scrimage:scrimage-core:$scrimage_version"
    implementation "com.vdurmont:emoji-java:$emoji_java_version"
    implementation "com.github.doyaaaaaken:kotlin-csv-jvm:$kotlin_csv_version"
    implementation "com.h2database:h2:$h2_version"
    implementation "com.natpryce:konfig:$konfig_version"
    implementation "org.koin:koin-core:$koin_version"
    implementation "com.github.twitch4j:twitch4j-helix:$twitch4j_version"
    implementation "com.github.twitch4j:twitch4j-chat:$twitch4j_version"

    testImplementation "org.jetbrains.kotlinx:kotlinx-coroutines-test:$coroutines_version"
    testImplementation "org.junit.jupiter:junit-jupiter:$junit5_version"
    testImplementation "io.mockk:mockk:$mockk_version"
    testImplementation "org.koin:koin-test:$koin_version"
}

sourceSets {
    main.kotlin.srcDirs += 'src/main/kotlin'
    main.resources.srcDirs += 'src/main/resources'
    test.kotlin.srcDirs += 'src/test/kotlin'
}

test {
    useJUnitPlatform()
}

shadowJar {
    // TODO Cannot minimize while using any type of reflection.  We cannot guarantee all dependencies will be included.  Find other ways to reduce jar size
//    minimize()
//    minimize {
//        exclude(dependency('com.h2database:h2:.*'))
//        exclude(dependency('org.jetbrains.exposed:.*'))
//        exclude(dependency('org.jetbrains.kotlin:kotlin-reflect:.*'))
//    }
}

jar {
    manifest {
        attributes 'Implementation-Title': 'RetroBot',
                'Main-Class': mainClassName
    }
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
}